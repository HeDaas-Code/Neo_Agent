# GUI可视化功能文档

## 概述

为域(Domain)和环境管理功能添加了完整的GUI可视化界面，使用户能够通过图形界面方便地管理环境和域。

## 新增GUI标签页

### 1. 🗺️ 环境管理标签页

#### 功能特性
- **环境列表**: 显示所有环境的名称、描述、状态和创建时间
- **添加环境**: 创建新的环境，包括名称、描述、氛围、光照、声音、气味等属性
- **编辑环境**: 修改现有环境的所有属性
- **删除环境**: 删除不需要的环境
- **激活环境**: 将选中的环境设为当前激活环境
- **悬停提示**: 鼠标悬停在环境上显示详细信息

#### 界面布局
```
┌─────────────────────────────────────────────────────┐
│ 工具栏                                               │
│ [➕添加环境] [✏编辑] [🗑删除] [✅激活] [🔄刷新]    │
│                                    环境数: X         │
├─────────────────────────────────────────────────────┤
│ 环境名称 │ 描述            │ 状态     │ 创建时间    │
│─────────────────────────────────────────────────────│
│ 小可的房间│ 温馨舒适的...  │ ✅激活   │ 2025-01-07 │
│ 小可的客厅│ 宽敞明亮的...  │ ⭕未激活 │ 2025-01-07 │
│ ...                                                  │
└─────────────────────────────────────────────────────┘
```

#### 操作流程

**添加环境**:
1. 点击"➕添加环境"按钮
2. 填写环境信息:
   - 环境名称（必填）
   - 整体描述（必填）
   - 氛围（可选）
   - 光照（可选）
   - 声音（可选）
   - 气味（可选）
3. 点击"保存"按钮

**编辑环境**:
1. 选中要编辑的环境
2. 双击或点击"✏编辑"按钮
3. 修改环境信息
4. 点击"保存"按钮

**激活环境**:
1. 选中要激活的环境
2. 点击"✅激活"按钮
3. 该环境将成为当前激活环境（用于视觉感知）

### 2. 🏘️ 域管理标签页

#### 功能特性
- **域列表**: 显示所有域的名称、描述、默认环境、包含环境数和创建时间
- **创建域**: 创建新的域，设置名称、描述和默认环境
- **编辑域**: 修改域的名称、描述和默认环境
- **删除域**: 删除域（不会删除其包含的环境）
- **管理环境**: 可视化管理域中包含的环境（添加/移除）
- **悬停提示**: 显示域的详细信息，包括包含的所有环境

#### 界面布局
```
┌──────────────────────────────────────────────────────────────┐
│ 工具栏                                                        │
│ [➕创建域] [✏编辑] [🗑删除] [📍管理环境] [🔄刷新]          │
│                                              域数: X          │
├──────────────────────────────────────────────────────────────┤
│ 域名称 │ 描述        │ 默认环境    │ 环境数 │ 创建时间      │
│──────────────────────────────────────────────────────────────│
│ 小可家 │ 小可的温... │ 小可的客厅  │ 3      │ 2025-01-07   │
│ 学校   │ 小可就读... │ 学校操场    │ 2      │ 2025-01-07   │
│ ...                                                           │
└──────────────────────────────────────────────────────────────┘
```

#### 操作流程

**创建域**:
1. 点击"➕创建域"按钮
2. 填写域信息:
   - 域名称（必填）
   - 描述（可选）
   - 默认环境（可选，从下拉列表选择）
3. 点击"保存"按钮

**编辑域**:
1. 选中要编辑的域
2. 双击或点击"✏编辑"按钮
3. 修改域信息
4. 点击"保存"按钮

**管理域的环境**:
1. 选中一个域
2. 点击"📍管理环境"按钮
3. 在弹出的窗口中:
   - 左侧显示域中已有的环境
   - 右侧显示所有可用环境
   - 使用"← 添加到域"按钮将环境添加到域
   - 使用"从域移除 →"按钮从域中移除环境
4. 完成后点击"关闭"按钮

**管理环境界面布局**:
```
┌─────────────────────────────────────────────────────────┐
│ 管理域的环境: 小可家                                     │
├──────────────┬─────────────┬────────────────────────────┤
│ 域中的环境   │  操作按钮   │ 所有环境                   │
├──────────────┼─────────────┼────────────────────────────┤
│ • 小可的房间 │             │ • 学校操场                 │
│ • 小可的客厅 │ [← 添加到域]│ • 教室                     │
│ • 小可的厨房 │             │ • 图书馆                   │
│              │ [从域移除 →]│ ...                        │
│              │             │                            │
│              │ [🔄 刷新]   │                            │
├──────────────┴─────────────┴────────────────────────────┤
│                      [关闭]                              │
└─────────────────────────────────────────────────────────┘
```

## 集成特性

### 自动刷新
- 新增的标签页已集成到自动刷新系统中
- 可以通过工具栏的刷新按钮手动刷新
- 支持自定义刷新间隔

### 数据一致性
- 所有操作实时更新到数据库
- 刷新后自动同步显示最新数据
- 删除域不会删除其包含的环境

### 用户体验
- **双击编辑**: 双击列表项快速进入编辑模式
- **悬停提示**: 鼠标悬停显示详细信息
- **确认对话框**: 删除操作有确认提示，防止误操作
- **实时计数**: 显示当前环境数和域数
- **友好提示**: 操作成功/失败有明确的提示消息

## 使用示例

### 场景1: 创建"小可家"域

1. **创建环境**:
   - 切换到"🗺️ 环境管理"标签页
   - 点击"➕添加环境"
   - 创建"小可的房间"、"小可的客厅"、"小可的厨房"

2. **创建域**:
   - 切换到"🏘️ 域管理"标签页
   - 点击"➕创建域"
   - 名称: "小可家"
   - 描述: "小可的温馨家庭"
   - 默认环境: "小可的客厅"

3. **添加环境到域**:
   - 选中"小可家"域
   - 点击"📍管理环境"
   - 从右侧列表选择"小可的房间"，点击"← 添加到域"
   - 同样添加"小可的客厅"和"小可的厨房"

4. **验证**:
   - 域列表中"小可家"显示环境数为3
   - 鼠标悬停在"小可家"上可以看到包含的所有环境

### 场景2: 切换当前环境

1. 切换到"🗺️ 环境管理"标签页
2. 选中"小可的房间"
3. 点击"✅激活"按钮
4. 当前环境切换为"小可的房间"
5. 状态列显示为"✅激活"

## 技术实现

### 数据绑定
- 使用`ttk.Treeview`显示列表数据
- 每行数据的`tags`属性存储UUID，用于操作识别
- 支持排序和滚动

### 对话框设计
- 使用`tk.Toplevel`创建模态对话框
- 输入验证确保数据有效性
- 异常处理提供友好错误提示

### 性能优化
- 列表项使用UUID标签而非完整对象
- 按需加载详细信息
- 缓存机制减少数据库查询

## 文件变更

### database_gui.py (+799行)

**新增方法**:

环境管理:
- `create_environments_tab()` - 创建环境管理标签页
- `refresh_environments()` - 刷新环境列表
- `add_environment()` - 添加环境对话框
- `edit_environment()` - 编辑环境对话框
- `delete_environment()` - 删除环境
- `activate_environment()` - 激活环境

域管理:
- `create_domains_tab()` - 创建域管理标签页
- `refresh_domains()` - 刷新域列表
- `add_domain()` - 添加域对话框
- `edit_domain()` - 编辑域对话框
- `delete_domain()` - 删除域
- `manage_domain_environments()` - 管理域环境对话框

### test_domain_gui.py (新增)
- GUI功能测试脚本
- 创建测试数据
- 验证界面功能

## 后续优化建议

1. **批量操作**: 支持批量添加/删除环境
2. **搜索过滤**: 添加环境和域的搜索功能
3. **导入导出**: 支持环境和域配置的导入导出
4. **可视化**: 添加域环境关系的图形化展示
5. **拖拽操作**: 支持拖拽方式管理域环境关联
6. **快捷键**: 添加常用操作的快捷键
7. **环境连接**: 可视化管理环境之间的连接关系

## 注意事项

1. **删除操作**: 删除域不会删除其包含的环境，只删除关联关系
2. **默认环境**: 域的默认环境必须是该域包含的环境之一（建议在添加后设置）
3. **激活状态**: 同一时间只有一个环境处于激活状态
4. **刷新机制**: 修改数据后会自动刷新相关标签页

## 截图说明

由于在无显示环境中运行，无法提供实际截图。但GUI界面具有以下特点:

1. **现代化设计**: 使用ttk组件，界面简洁现代
2. **图标丰富**: 按钮使用emoji图标，易于识别
3. **布局合理**: 工具栏在顶部，列表在中间，统计信息在右侧
4. **响应式**: 支持窗口大小调整
5. **主题一致**: 与现有标签页风格统一

用户在实际使用时会看到与其他标签页一致的界面风格。
