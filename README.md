# 🚀 深空迷航：记忆碎片

一个基于大语言模型驱动的科幻文字冒险游戏，采用模块化架构设计，实现了智能角色对话、动态记忆系统、知识图谱管理和五阶段处理流程。

## 🎮 游戏概念

在这个游戏中，玩家扮演一个被困在损坏飞船上的AI系统，需要与幸存的船员合作求生。游戏的核心特色包括：

- **🤖 LLM驱动角色**: 船员由大语言模型扮演，具有真实的人格和情感反应
- **🔐 权限层级系统**: 玩家需要逐步提升AI权限来解锁新功能和区域
- **💾 数据碎片收集**: 通过收集数据碎片来修复知识图谱，揭示真相
- **❤️ 生命指标监测**: 实时监控船员的生理和心理状态
- **⚡ 动态事件系统**: 基于游戏状态触发各种紧急情况和剧情分支
- **🧠 五阶段处理**: 认知→记忆→理解→决策→执行的完整AI处理流程

## 🏗️ 系统架构

### 核心模块

- **🎯 start_game.py**: 游戏启动入口，负责程序初始化和主循环控制
- **🎮 game_controller.py**: 游戏调控模块，协调各个子系统和游戏流程
- **🖥️ console_ui.py**: 控制台用户界面，处理输入输出和界面显示
- **🧠 llm_core.py**: LLM核心引擎，实现五阶段AI处理流程
- **⚙️ config_manager.py**: 配置管理器，统一管理所有配置文件

### 五阶段处理流程

1. **认知阶段 (Cognition)**: 接收和预处理用户输入
2. **记忆阶段 (Memory)**: 检索相关历史记忆和上下文
3. **理解阶段 (Understanding)**: 深度理解用户意图和游戏状态
4. **决策阶段 (Decision)**: 基于理解结果制定响应策略
5. **执行阶段 (Execution)**: 执行决策并生成最终响应

### 技术栈

- **主模型**: DeepSeek-R1 (通过硅基流动API)
- **嵌入模型**: BAAI/bge-m3 (本地部署)
- **向量数据库**: ChromaDB
- **知识图谱**: NetworkX
- **配置管理**: JSON + 动态加载
- **UI框架**: 控制台界面 + 彩色输出

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone <repository-url>
cd Project

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置设置

复制配置模板并填入你的API密钥：

```bash
# 复制模板文件
cp config/model.template.json config/model.json
```

编辑 `config/model.json`：

```json
{
  "model": {
    "deepseek_api_key": "YOUR_DEEPSEEK_API_KEY_HERE",
    "api_base": "https://api.siliconflow.cn/v1",
    "model_name": "deepseek-ai/DeepSeek-R1-0528-Qwen3-8B",
    "bge_model_path": "BAAI/bge-m3"
  }
}
```

### 3. 启动游戏

```bash
# 启动完整游戏（推荐）
python start_game.py
```

### 4. 快速体验

```bash
# 测试基础功能（无需API密钥）
python test_input.py
```

## 📋 功能特性

### 🧠 智能对话系统

- **角色一致性**: 基于人格设定和当前状态生成符合角色的回应
- **上下文感知**: 利用向量记忆库维持长期对话连贯性
- **情感状态**: 根据角色的生理和心理状态调整对话风格
- **知识边界**: 严格限制角色只能回答已解锁的知识内容
- **自然语言处理**: 支持自然语言命令输入和理解

### 🗃️ 记忆系统

- **向量存储**: 使用BGE-M3模型将对话和事件转换为向量存储
- **语义检索**: 基于语义相似度检索相关历史记忆
- **分类管理**: 按对话、事件、发现等类型组织记忆
- **持久化**: 记忆数据持久保存，支持游戏存档
- **动态更新**: 实时更新记忆库，保持上下文连贯性

### 🕸️ 知识图谱

- **分层解锁**: 知识按权限等级分层，逐步解锁
- **碎片系统**: 通过收集数据碎片来解锁新知识
- **依赖关系**: 某些知识需要前置条件才能解锁
- **动态更新**: 支持运行时动态添加新知识节点
- **关系推理**: 基于知识图谱进行逻辑推理

### 🎯 权限系统

- **等级控制**: 从紧急权限(1级)到核心权限(7级)
- **功能解锁**: 不同权限等级解锁不同的系统功能
- **区域访问**: 控制玩家可以访问的飞船区域
- **渐进式**: 通过完成任务和收集碎片提升权限
- **动态验证**: 实时验证权限状态和访问控制

### 🎲 事件系统

- **动态触发**: 基于时间、健康状态、权限等级触发事件
- **多重结局**: 不同的选择和状态导向不同的游戏结局
- **状态影响**: 事件会影响角色状态和可用系统
- **分支剧情**: 支持复杂的剧情分支和条件判断
- **实时响应**: 根据玩家行为实时调整事件触发

### 💾 存档系统

- **自动保存**: 每10轮自动保存游戏进度
- **手动存档**: 支持玩家手动保存和加载
- **退出保存**: 游戏退出时自动保存当前状态
- **多存档**: 支持多个存档槽位管理
- **状态完整性**: 完整保存游戏状态和角色数据

## 🔧 配置说明

### 配置文件结构

```
config/
├── model.json          # 模型配置（需要手动创建）
├── model.template.json # 模型配置模板
├── character.json      # 角色配置
├── game.json          # 游戏基础配置
├── knowledge.json     # 知识图谱配置
├── memory.json        # 记忆系统配置
├── script.json        # 剧本和事件配置
└── index.json         # 配置索引文件
```

### 主要配置项

- **模型配置**: API密钥、模型名称、嵌入模型路径
- **角色配置**: 角色属性、性格、背景故事
- **游戏配置**: 权限等级、健康系统、时间系统
- **知识配置**: 知识节点、解锁条件、依赖关系
- **记忆配置**: 向量数据库设置、检索参数
- **剧本配置**: 事件定义、触发条件、剧情分支

## 🧪 测试和调试

### 运行测试

```bash
# 测试输入处理
python test_input.py

# 启动游戏（完整功能）
python start_game.py
```

### 调试模式

游戏内置详细的日志系统，会自动输出各阶段的处理信息：

- ✓ 认知阶段完成
- ✓ 记忆检索完成
- ✓ 理解阶段完成
- ✓ 决策阶段完成
- ✓ 执行阶段完成

## 📁 项目结构

```
Project/
├── start_game.py        # 🚀 游戏启动入口
├── game_controller.py   # 🎮 游戏调控模块
├── console_ui.py        # 🖥️ 控制台用户界面
├── llm_core.py         # 🧠 LLM核心引擎
├── config_manager.py   # ⚙️ 配置管理器
├── test_input.py       # 🧪 测试脚本
├── requirements.txt    # 📦 依赖列表
├── README.md          # 📖 项目文档
├── .gitignore         # 🚫 Git忽略文件
├── config/            # ⚙️ 配置文件目录
│   ├── model.template.json
│   ├── character.json
│   ├── game.json
│   ├── knowledge.json
│   ├── memory.json
│   ├── script.json
│   └── index.json
└── saves/             # 💾 存档目录（自动生成）
    └── *.json
```

### 模块说明

- **start_game.py**: 程序入口点，负责游戏启动和异常处理
- **game_controller.py**: 游戏主控制器，协调各个子系统
- **console_ui.py**: 用户界面层，处理输入输出和界面显示
- **llm_core.py**: AI核心引擎，实现五阶段处理流程
- **config_manager.py**: 配置管理，统一加载和管理配置文件

## 🎮 游戏玩法

### 基本操作

- 使用自然语言与游戏世界互动
- 输入 `help` 查看帮助信息
- 输入 `quit` 退出游戏
- 输入 `save <存档名>` 保存游戏
- 输入 `load <存档名>` 加载游戏

### 游戏目标

1. **生存**: 维持角色的健康和心理状态
2. **探索**: 解锁飞船的各个区域
3. **收集**: 寻找数据碎片修复知识图谱
4. **提升**: 逐步提升AI权限等级
5. **真相**: 揭示飞船事故的真相

### 游戏机制

- **状态管理**: 健康、压力、能量、心情四大指标
- **权限系统**: 7个权限等级，逐步解锁功能
- **记忆系统**: AI会记住所有互动历史
- **知识图谱**: 通过碎片解锁新的知识和能力
- **事件触发**: 基于状态和时间的动态事件

## 🔮 扩展开发

### 添加新角色

1. 在 `config/character.json` 中定义角色属性
2. 更新角色控制逻辑
3. 添加角色特定的对话模板

### 添加新事件

1. 在 `config/script.json` 中定义事件
2. 设置触发条件和效果
3. 更新事件处理逻辑

### 集成新模型

1. 扩展 `llm_core.py` 中的模型管理
2. 更新配置文件格式
3. 添加新的API调用方法

### 自定义UI

1. 扩展 `console_ui.py` 的界面功能
2. 添加新的显示组件
3. 实现自定义输入处理

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- [DeepSeek](https://www.deepseek.com/) - 提供强大的语言模型
- [BAAI](https://www.baai.ac.cn/) - BGE嵌入模型
- [ChromaDB](https://www.trychroma.com/) - 向量数据库
- [Sentence Transformers](https://www.sbert.net/) - 文本嵌入框架

---

**🎯 开始你的深空冒险之旅吧！** 在这个AI驱动的科幻世界中，每一个选择都可能改变命运的走向。

**⚠️ 注意**: 请确保在使用前正确配置API密钥和模型参数。首次运行可能需要下载嵌入模型，请保持网络连接。